<!DOCTYPE html>
<html>
<head>
    <title>人生模拟器</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .stats { background: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
        .event { background: #e0f7fa; padding: 8px; margin: 5px 0; border-radius: 3px; }
        button { margin: 5px; padding: 8px 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>人生模拟器</h1>
    <div id="game">
        <div id="stats" class="stats"></div>
        <div id="events"></div>
        <div id="choices"></div>
    </div>
    <script>
        const player = {
            name: "",
            age: 0,
            health: 100,
            happiness: 100,
            money: 0,
            alive: true,
            events: [],
            startYear: new Date().getFullYear() - Math.floor(Math.random() * 100),
        };

        function startGame() {
            player.name = prompt("你的名字是？", "张三");
            player.gender = prompt("你的性别是？", "男");
            logEvent(`${player.name} 出生了！`);
            nextYear();
        }

        function nextYear() {
            if (!player.alive) return;
            
            player.age++;
            player.health += Math.floor(Math.random() * 6) - 2;
            player.happiness += Math.floor(Math.random() * 6) - 2;
            
            // 防止数值溢出
            player.health = Math.max(0, Math.min(100, player.health));
            player.happiness = Math.max(0, Math.min(100, player.happiness));

            // 随机事件
            if (Math.random() < 0.3) {
                const events = [
                    { msg: "你感冒了", health: -10, happiness: -5 },
                    { msg: "你捡到钱", money: 50 },
                    { msg: "你交到了新朋友", happiness: 15 },
                    { msg: "你遭遇车祸", health: -30, happiness: -20 },
                ];
                const event = events[Math.floor(Math.random() * events.length)];
                player.money += event.money || 0;
                player.health += event.health || 0;
                player.happiness += event.happiness || 0;
                logEvent(event.msg);
            }

            // 检查死亡
            if (player.health <= 0 || (player.age > 80 && Math.random() > 0.8)) {
                player.alive = false;
                const causes = ["老死", "心脏病", "意外事故", "绝症"];
                logEvent(`💀 ${player.name} 因 ${causes[Math.floor(Math.random() * causes.length)]} 去世，享年 ${player.age} 岁`);
                saveLife();
                return;
            }

            updateUI();
            showChoices();
        }

        function logEvent(msg) {
            player.events.push(`${player.age} 岁: ${msg}`);
            const eventsDiv = document.getElementById("events");
            eventsDiv.innerHTML += `<div class="event">${player.age} 岁: ${msg}</div>`;
            eventsDiv.scrollTop = eventsDiv.scrollHeight;
        }

        function updateUI() {
            const statsDiv = document.getElementById("stats");
            statsDiv.innerHTML = `
                <h2>${player.name} (${player.age} 岁, ${player.startYear + player.age} 年)</h2>
                <p>❤️ 健康: ${player.health}/100</p>
                <p>😊 快乐: ${player.happiness}/100</p>
                <p>💰 金钱: ${player.money}</p>
            `;
        }

        function showChoices() {
            const choicesDiv = document.getElementById("choices");
            choicesDiv.innerHTML = "";
            
            const choices = [
                { text: "工作", money: 50, happiness: -10 },
                { text: "休息", health: 10, happiness: 5 },
                { text: "社交", happiness: 15, money: -10 },
                { text: "锻炼", health: 15, happiness: -5 },
            ];

            choices.forEach(choice => {
                const button = document.createElement("button");
                button.textContent = choice.text;
                button.onclick = () => {
                    player.money += choice.money || 0;
                    player.health += choice.health || 0;
                    player.happiness += choice.happiness || 0;
                    logEvent(`你选择了 ${choice.text}`);
                    nextYear();
                };
                choicesDiv.appendChild(button);
            });
        }

        function saveLife() {
            const data = JSON.stringify(player, null, 2);
            const blob = new Blob([data], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `${player.name}_人生记录.json`;
            a.click();
        }

        startGame();
    </script>
</body>
</html>