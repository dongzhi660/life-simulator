<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿæ¨¡æ‹Ÿå™¨ - ä¼˜åŒ–ç‰ˆ</title>
    <style>
        /* å“åº”å¼å¸ƒå±€ */
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        /* çŠ¶æ€è¿›åº¦æ¡ */
        .status-bar {
            background: #eee;
            border-radius: 10px;
            margin: 10px 0;
            padding: 10px;
        }
        .progress {
            height: 20px;
            border-radius: 10px;
            transition: width 0.3s;
        }
        #health .progress { background: #4CAF50; }
        #happiness .progress { background: #FFC107; }

        /* æŒ‰é’®å¸ƒå±€ */
        .choices {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }
        button {
            padding: 12px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover {
            background: #1976D2;
        }

        /* äº‹ä»¶æ—¥å¿— */
        #event-log {
            height: 200px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div id="game">
        <h1 id="player-name"></h1>
        <div class="status-bar" id="health">
            <div class="progress" style="width: 100%"></div>
            <div>å¥åº·: <span id="health-value">100</span>/100</div>
        </div>
        <div class="status-bar" id="happiness">
            <div class="progress" style="width: 100%"></div>
            <div>å¿«ä¹: <span id="happiness-value">100</span>/100</div>
        </div>
        <div>ğŸ’° è´¢å¯Œ: <span id="money">0</span></div>
        
        <div id="event-log"></div>
        <div class="choices" id="choices"></div>
    </div>

    <script>
        // æ¸¸æˆæ ¸å¿ƒé€»è¾‘
        class LifeSimulator {
            constructor() {
                this.name = '';
                this.age = 0;
                this.health = 100;
                this.happiness = 100;
                this.money = 0;
                this.startYear = new Date().getFullYear() - Math.floor(Math.random() * 100);
                this.events = [];
                this.alive = true;
            }

            // å±æ€§æ›´æ–°å™¨ï¼ˆè‡ªåŠ¨é™åˆ¶èŒƒå›´ï¼‰
            updateAttribute(value, min, max) {
                return Math.max(min, Math.min(value, max));
            }

            // å¹´é¾„é˜¶æ®µéªŒè¯
            getAgeStage() {
                if (this.age < 6) return 'å¹¼å„¿æœŸ';
                if (this.age < 18) return 'é’å°‘å¹´';
                if (this.age < 65) return 'æˆå¹´æœŸ';
                return 'è€å¹´æœŸ';
            }

            // è·å–å¯é€‰åŠ¨ä½œ
            getAvailableChoices() {
                const stages = {
                    'å¹¼å„¿æœŸ': ['ç©è€', 'å­¦ä¹ ', 'ä¼‘æ¯'],
                    'é’å°‘å¹´': ['ä¸Šå­¦', 'è¿åŠ¨', 'å…¼èŒ'],
                    'æˆå¹´æœŸ': ['å·¥ä½œ', 'ç¤¾äº¤', 'æŠ•èµ„', 'ç»“å©š'],
                    'è€å¹´æœŸ': ['é€€ä¼‘', 'å…»ç”Ÿ', 'å¸¦å­™å­']
                };
                return stages[this.getAgeStage()] || [];
            }

            // å¤„ç†ç©å®¶é€‰æ‹©
            handleChoice(choice) {
                const effects = {
                    'å·¥ä½œ':    { money: 80,  happiness: -20, health: -15 },
                    'ç©è€':    { happiness: 25, health: 5 },
                    'å­¦ä¹ ':    { happiness: -10, money: -30 },
                    'ä¼‘æ¯':    { health: 20, happiness: 10 },
                    'æŠ•èµ„':    { money: Math.random() > 0.5 ? 200 : -150 }
                };

                // åº”ç”¨æ•ˆæœ
                Object.entries(effects[choice] || {}).forEach(([key, value]) => {
                    this[key] = this.updateAttribute(this[key] + value, 0, 100);
                });

                // è®°å½•äº‹ä»¶
                this.recordEvent(choice);
                this.checkRandomEvent();
                this.checkDeath();
            }

            // éšæœºäº‹ä»¶ç³»ç»Ÿ
            checkRandomEvent() {
                if (Math.random() < 0.3) {
                    const events = {
                        'å¹¼å„¿æœŸ': [
                            { msg: "ä½ å¾—äº†é‡æ„Ÿå†’", health: -25 },
                            { msg: "å‘ç°ç»˜ç”»å¤©èµ‹", happiness: 15 }
                        ],
                        'é’å°‘å¹´': [
                            { msg: "æ ¡å›­éœ¸å‡Œäº‹ä»¶", happiness: -30 },
                            { msg: "è·å¾—å¥–å­¦é‡‘", money: 500 }
                        ],
                        // ...å…¶ä»–é˜¶æ®µäº‹ä»¶
                    };
                    
                    const event = events[this.getAgeStage()]?.[Math.floor(Math.random()*2)];
                    if (event) {
                        Object.entries(event).forEach(([key, value]) => {
                            if (key !== 'msg') this[key] += value;
                        });
                        this.recordEvent(event.msg);
                    }
                }
            }

            // æ­»äº¡æ£€æŸ¥
            checkDeath() {
                let deathRisk = 0;
                if (this.health <= 0) deathRisk = 1;
                if (this.age > 80) deathRisk += (this.age - 80) * 0.1;
                
                if (Math.random() < deathRisk) {
                    this.alive = false;
                    this.recordEvent("ğŸ’€ ç”Ÿå‘½ç»ˆç»“");
                }
            }

            recordEvent(msg) {
                this.events.push(`${this.age}å²: ${msg}`);
            }
        }

        // æ¸¸æˆç•Œé¢æ§åˆ¶å™¨
        class GameUI {
            constructor() {
                this.game = new LifeSimulator();
                this.init();
            }

            init() {
                this.game.name = prompt("è¯·è¾“å…¥è§’è‰²å§“å", "å¼ ä¸‰");
                this.game.startYear = new Date().getFullYear() - this.game.age;
                this.updateUI();
                this.nextYear();
            }

            updateUI() {
                // æ›´æ–°æ•°å€¼æ˜¾ç¤º
                document.getElementById('health-value').textContent = this.game.health;
                document.getElementById('happiness-value').textContent = this.game.happiness;
                document.getElementById('money').textContent = this.game.money;
                
                // æ›´æ–°è¿›åº¦æ¡
                document.querySelector('#health .progress').style.width = `${this.game.health}%`;
                document.querySelector('#happiness .progress').style.width = `${this.game.happiness}%`;

                // æ›´æ–°äº‹ä»¶æ—¥å¿—
                const eventLog = document.getElementById('event-log');
                eventLog.innerHTML = this.game.events.slice(-5).join('<br>');
                eventLog.scrollTop = eventLog.scrollHeight;
            }

            nextYear() {
                if (!this.game.alive) return this.gameOver();

                this.game.age++;
                this.renderChoices();
                this.updateUI();
            }

            renderChoices() {
                const container = document.getElementById('choices');
                container.innerHTML = this.game.getAvailableChoices()
                    .map(choice => `<button onclick="ui.handleChoice('${choice}')">${choice}</button>`)
                    .join('');
            }

            handleChoice(choice) {
                this.game.handleChoice(choice);
                this.nextYear();
            }

            gameOver() {
                document.getElementById('choices').innerHTML = `
                    <h3>æ¸¸æˆç»“æŸ</h3>
                    <p>${this.game.name}äº«å¹´ ${this.game.age} å²</p>
                    <button onclick="location.reload()">é‡æ–°å¼€å§‹</button>
                `;
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        const ui = new GameUI();
    </script>
</body>
</html>